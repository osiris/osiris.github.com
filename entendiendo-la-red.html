<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
<head>
<title>entendiendo la red</title>
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Osiris Alejandro Gómez" />
<link rel="stylesheet" href="osiux.css" type="text/css" />
<link rel="stylesheet" href="print.css" type="text/css" media="print" />
</head>
<body>
<div id="content">
<h1 class="title">entendiendo la red</h1>
<p>
<a href="index.html">index</a> | <a href="osiux.html">OSiUX</a> | <a href="blog.html">blog</a> | <a href="docs.html">docs</a> | <a href="charlas.html">charlas</a> | <a href="index.xml">rss</a>
</p>

<div id="outline-container-unnumbered-1" class="outline-2">
<h2 id="unnumbered-1">Topología, redes y Subredes</h2>
<div class="outline-text-2" id="text-unnumbered-1">
<ul class="org-ul">
<li><p>
centralizada
</p>


<div class="figure">
<p><img src="img/redes-centralizadas.png" alt="redes-centralizadas.png" />
</p>
</div></li>

<li><p>
descentralizada
</p>


<div class="figure">
<p><img src="img/redes-descentralizadas.png" alt="redes-descentralizadas.png" />
</p>
</div></li>

<li><p>
en malla o <i>mesh</i>
</p>


<div class="figure">
<p><img src="img/redes-mesh.png" alt="redes-mesh.png" />
</p>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-unnumbered-2" class="outline-2">
<h2 id="unnumbered-2">Asignación de IPs por medio de DHCP</h2>
<div class="outline-text-2" id="text-unnumbered-2">
<ul class="org-ul">
<li>DHCP server</li>
<li>DHCP client</li>
</ul>
</div>

<div id="outline-container-unnumbered-3" class="outline-3">
<h3 id="unnumbered-3">Red de 4 equipos</h3>
<div class="outline-text-3" id="text-unnumbered-3">

<div class="figure">
<p><img src="img/redes-lan.png" alt="redes-lan.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-unnumbered-4" class="outline-3">
<h3 id="unnumbered-4"><code>B</code> dice, <b>necesito una IP!</b></h3>
<div class="outline-text-3" id="text-unnumbered-4">
<ul class="org-ul">
<li>mensaje: <code>DHCPDISCOVER</code></li>
<li>protocolo: UDP</li>
<li>puerto destino: 67</li>
<li>dirección física: 01:12:23:34:45:bb</li>
</ul>


<div class="figure">
<p><img src="img/redes-dhcp-discover.png" alt="redes-dhcp-discover.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-unnumbered-5" class="outline-3">
<h3 id="unnumbered-5"><code>D</code> dice, <b>yo te puedo dar IP!</b></h3>
<div class="outline-text-3" id="text-unnumbered-5">
<ul class="org-ul">
<li>mensaje: <code>DHCPOFFER</code></li>
<li>dirección física: 01:12:23:34:45:dd</li>
<li>dirección IP: 192.168.10.102</li>
<li>gateway: 192.168.10.1</li>
<li>dns primario: 8.8.8.8</li>
<li>dns secundario: 8.8.4.4</li>
</ul>


<div class="figure">
<p><img src="img/redes-dhcp-offer.png" alt="redes-dhcp-offer.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-unnumbered-6" class="outline-3">
<h3 id="unnumbered-6"><code>B</code> dice, confirmo recepción!</h3>
<div class="outline-text-3" id="text-unnumbered-6">
<ul class="org-ul">
<li>mensaje: <code>DHCPREQUEST</code></li>
</ul>


<div class="figure">
<p><img src="img/redes-dhcp-request.png" alt="redes-dhcp-request.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-unnumbered-7" class="outline-3">
<h3 id="unnumbered-7"><code>D</code> dice, confirmo confirmación!</h3>
<div class="outline-text-3" id="text-unnumbered-7">
<ul class="org-ul">
<li>mensaje: <code>DHCPACK</code></li>
</ul>


<div class="figure">
<p><img src="img/redes-dhcp-ack.png" alt="redes-dhcp-ack.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-unnumbered-8" class="outline-2">
<h2 id="unnumbered-8">Resolución de nombres de dominios DNS</h2>
<div class="outline-text-2" id="text-unnumbered-8">
<div class="org-src-container">

<pre class="src src-sh">host localhost
</pre>
</div>

<pre class="example">
localhost.lan has address 127.0.0.1
</pre>

<div class="org-src-container">

<pre class="src src-sh">dig osiux.com
</pre>
</div>

<pre class="example">
; &lt;&lt;&gt;&gt; DiG 9.9.5-4.2-Debian &lt;&lt;&gt;&gt; osiux.com
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 29452
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;osiux.com.			IN	A

;; ANSWER SECTION:
osiux.com.		2275	IN	A	198.23.230.106

;; Query time: 3 msec
;; SERVER: 10.254.111.239#53(10.254.111.239)
;; WHEN: Sat Mar 28 16:06:38 ART 2015
;; MSG SIZE  rcvd: 43
</pre>
</div>

<div id="outline-container-unnumbered-9" class="outline-3">
<h3 id="unnumbered-9">viendo un paquete de query dns</h3>
<div class="outline-text-3" id="text-unnumbered-9">
<div class="org-src-container">

<pre class="src src-sh">tcpdump -r dns-query.pcap -nvX
</pre>
</div>
</div>
</div>

<div id="outline-container-unnumbered-10" class="outline-3">
<h3 id="unnumbered-10">analizando un paquete de query dns</h3>
<div class="outline-text-3" id="text-unnumbered-10">
<div class="org-src-container">

<pre class="src src-sh">tshark -r dns-query.pcap -VO dns
</pre>
</div>
</div>
</div>

<div id="outline-container-unnumbered-11" class="outline-3">
<h3 id="unnumbered-11">capturar consultas al dns</h3>
<div class="outline-text-3" id="text-unnumbered-11">
<pre class="example">
ssh root@linksys '/usr/sbin/tcpdump -i br0 -s 0 -w - dst port 53' &gt;linksys.pcap
</pre>
</div>
</div>

<div id="outline-container-unnumbered-12" class="outline-3">
<h3 id="unnumbered-12">ranking de dns</h3>
<div class="outline-text-3" id="text-unnumbered-12">
<pre class="example">
tcpdump -r linksys.pcap -c 2000 -nnnA dst port 53 | \
egrep -o "A+\? .*\." | sed s/".$"//g | awk '{print $2}' | \
egrep -v "(osiux|fbcdn|akamai)" | sort | uniq -c | sort -nr | head
</pre>

<table id="ranking-dns" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="right" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="right">47</td>
<td class="left">www.facebook.com</td>
</tr>

<tr>
<td class="right">42</td>
<td class="left">dns.msftncsi.com</td>
</tr>

<tr>
<td class="right">41</td>
<td class="left">su.ff.avast.com</td>
</tr>

<tr>
<td class="right">37</td>
<td class="left">ssl.google-analytics.com</td>
</tr>

<tr>
<td class="right">37</td>
<td class="left">ipv6.msftncsi.com</td>
</tr>

<tr>
<td class="right">32</td>
<td class="left">www.habbo.es</td>
</tr>

<tr>
<td class="right">26</td>
<td class="left">imap.googlemail.com</td>
</tr>

<tr>
<td class="right">21</td>
<td class="left">dynamic.zoneedit.com</td>
</tr>

<tr>
<td class="right">19</td>
<td class="left">www.msftncsi.com</td>
</tr>

<tr>
<td class="right">18</td>
<td class="left">kiwwwi.com.ar</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-unnumbered-13" class="outline-2">
<h2 id="unnumbered-13">Sniffers nmap, dsniff</h2>
<div class="outline-text-2" id="text-unnumbered-13">
</div><div id="outline-container-unnumbered-14" class="outline-3">
<h3 id="unnumbered-14">nmap</h3>
<div class="outline-text-3" id="text-unnumbered-14">
<div class="org-src-container">

<pre class="src src-sh">nmap -sV --open 192.168.10.0/24 -p22 | head
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-unnumbered-15" class="outline-2">
<h2 id="unnumbered-15">Túneles y Redes Privadas Virtuales VPN</h2>
<div class="outline-text-2" id="text-unnumbered-15">
</div><div id="outline-container-unnumbered-16" class="outline-3">
<h3 id="unnumbered-16">Redireccionar puertos con <code>ssh</code></h3>
<div class="outline-text-3" id="text-unnumbered-16">
<pre class="example">
ssh -L 2525:localhost:25 osiux.com
</pre>
</div>
</div>

<div id="outline-container-unnumbered-17" class="outline-3">
<h3 id="unnumbered-17">Proxy Socks mediante ssh</h3>
<div class="outline-text-3" id="text-unnumbered-17">
<pre class="example">
ssh -D 9090 osiux.com
</pre>
</div>
</div>

<div id="outline-container-unnumbered-18" class="outline-3">
<h3 id="unnumbered-18">Tunel reverso con ssh</h3>
<div class="outline-text-3" id="text-unnumbered-18">
<pre class="example">
ssh -R 12345:localhost:22 osiux.com
</pre>
</div>
</div>
</div>
<div id="outline-container-unnumbered-19" class="outline-2">
<h2 id="unnumbered-19">Cómo saber la IP de un equipo?</h2>
<div class="outline-text-2" id="text-unnumbered-19">
</div><div id="outline-container-unnumbered-20" class="outline-3">
<h3 id="unnumbered-20">B dice, <b>cuál es la IP de D?</b></h3>
<div class="outline-text-3" id="text-unnumbered-20">
<ul class="org-ul">
<li>Se que D es <b>00:14:d1:18:4a:dd</b></li>
<li>Yo soy B y mi mac es <b>00:14:d1:18:4a:bb</b></li>
<li>Todos reciben paquete ARP por difusión</li>
</ul>


<div class="figure">
<p><img src="img/redes-arp-1.png" alt="redes-arp-1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-unnumbered-21" class="outline-3">
<h3 id="unnumbered-21">D contesta, <b>mi IP es 10.4.14.225</b></h3>
<div class="outline-text-3" id="text-unnumbered-21">

<div class="figure">
<p><img src="img/redes-arp-2.png" alt="redes-arp-2.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-unnumbered-22" class="outline-3">
<h3 id="unnumbered-22">Quénes están en esta red?</h3>
<div class="outline-text-3" id="text-unnumbered-22">
<div class="org-src-container">

<pre class="src src-sh">sudo arp-scan --interface eth0 --localnet
</pre>
</div>
</div>
</div>

<div id="outline-container-unnumbered-23" class="outline-3">
<h3 id="unnumbered-23">pingueando</h3>
<div class="outline-text-3" id="text-unnumbered-23">
<div class="org-src-container">

<pre class="src src-sh">ping -c 5 127.0.0.1
</pre>
</div>

<pre class="example">
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.042 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.039 ms
64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.044 ms
64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.046 ms
64 bytes from 127.0.0.1: icmp_seq=5 ttl=64 time=0.045 ms

--- 127.0.0.1 ping statistics ---
5 packets transmitted, 5 received, 0% packet loss, time 3997ms
rtt min/avg/max/mdev = 0.039/0.043/0.046/0.004 ms
</pre>
</div>
</div>

<div id="outline-container-unnumbered-24" class="outline-3">
<h3 id="unnumbered-24">capturando pings</h3>
<div class="outline-text-3" id="text-unnumbered-24">
<pre class="example">
sudo tcpdump -i lo -nnnt -c 5 icmp
</pre>
</div>
</div>

<div id="outline-container-unnumbered-25" class="outline-3">
<h3 id="unnumbered-25">viendo un <code>ping</code></h3>
<div class="outline-text-3" id="text-unnumbered-25">
<pre class="example">
sudo tcpdump -i lo -nnntvvX -c 1 -e icmp
</pre>

<pre class="example">
00:00:00:00:00:00 &gt; 00:00:00:00:00:00, ethertype IPv4 (0x0800), length 98: (tos 0x0, ttl 64, id 0, offset 0, flags [DF], proto ICMP (1), length 84)
    127.0.0.1 &gt; 127.0.0.1: ICMP echo request, id 4177, seq 329, length 64
  0x0000:  4500 0054 0000 4000 4001 3ca7 7f00 0001  E..T..@.@.&lt;.....
  0x0010:  7f00 0001 0800 a68d 1051 0149 e754 5e51  .........Q.I.T^Q
  0x0020:  022f 0d00 0809 0a0b 0c0d 0e0f 1011 1213  ./..............
  0x0030:  1415 1617 1819 1a1b 1c1d 1e1f 2021 2223  .............!"#
  0x0040:  2425 2627 2829 2a2b 2c2d 2e2f 3031 3233  $%&amp;'()*+,-./0123
  0x0050:  3435 3637                                4567
</pre>
</div>
</div>
</div>

<div id="outline-container-unnumbered-26" class="outline-2">
<h2 id="unnumbered-26">traceroute</h2>
<div class="outline-text-2" id="text-unnumbered-26">
<div class="org-src-container">

<pre class="src src-sh">traceroute -m 100 216.81.59.173
</pre>
</div>

<pre class="example">
traceroute to 216.81.59.173 (216.81.59.173), 100 hops max, 60 byte packets
 1  leosia.lan (10.254.111.239)  1.640 ms  1.595 ms  1.579 ms
 2  10.4.14.225 (10.4.14.225)  3.329 ms  5.220 ms  5.214 ms
 3  1-212-126-200.fibertel.com.ar (200.126.212.1)  25.004 ms  25.231 ms  32.030 ms
 4  * * *
 5  * * *
 6  * * *
 7  73-164-89-200.fibertel.com.ar (200.89.164.73)  18.445 ms 109-165-89-200.fibertel.com.ar (200.89.165.109)  15.037 ms 145-164-89-200.fibertel.com.ar (200.89.164.145)  15.821 ms
 8  130-165-89-200.fibertel.com.ar (200.89.165.130)  14.268 ms  23.929 ms  23.838 ms
 9  222-165-89-200.fibertel.com.ar (200.89.165.222)  26.522 ms  24.973 ms  19.260 ms
10  xe-1-2-2.ar3.eze1.gblx.net (208.178.244.213)  17.765 ms  17.596 ms  21.649 ms
11  po3-20G.ar2.MIA2.gblx.net (67.16.139.18)  175.896 ms  148.889 ms po2-30G.ar2.MIA2.gblx.net (67.17.106.162)  172.247 ms
12  xe-0-3-0.mia10.ip4.tinet.net (213.200.84.37)  160.827 ms  173.191 ms  161.483 ms
13  xe-5-3-2.atl11.ip4.gtt.net (89.149.128.113)  160.288 ms xe-2-1-0.atl11.ip4.gtt.net (89.149.128.25)  152.378 ms  163.302 ms
14  * * *
15  * * *
16  * * *
17  * * *
18  * * *
19  * * *
20  * * *
21  * * *
22  * * *
23  * * *
24  * * *
25  * * *
26  * * *
27  * * *
28  * * *
29  * * *
30  * * *
31  * * *
32  * * *
33  * * *
34  * * *
35  * * *
36  * * *
37  * * *
38  * * *
39  * * *
40  * * *
41  * * *
42  * * *
43  * * *
44  * * *
45  * * *
46  * * *
47  * * *
48  * * *
49  * * *
50  * * *
51  * * *
52  * * *
53  * * *
54  * * *
55  * * *
56  * * *
57  * * *
58  * * *
59  * * *
60  * * *
61  * * *
62  * * *
63  * * *
64  * * *
65  * * *
66  * * *
67  * * *
68  * * *
69  * * *
70  * * *
71  * * *
72  * * *
73  * * *
74  * * *
75  * * *
76  * * *
77  * * *
78  * * *
79  * * *
80  * * *
81  * * *
82  * * *
83  * * *
84  * * *
85  * * *
86  * * *
87  * * *
88  * * *
89  * * *
90  * * *
91  * * *
92  * * *
93  * * *
94  * * *
95  * * *
96  * * *
97  * * *
98  * * *
99  * * *
100  * * *
</pre>

<div class="org-src-container">

<pre class="src src-sh">traceroute -m 255 obiwan.scrye.net | awk {<span style="color: #ad7fa8; font-style: italic;">'print $2'</span>}
</pre>
</div>
</div>
</div>

<div id="outline-container-unnumbered-27" class="outline-2">
<h2 id="unnumbered-27">protocolos</h2>
<div class="outline-text-2" id="text-unnumbered-27">

<div class="figure">
<p><img src="img/redes-protocolos-1.png" alt="redes-protocolos-1.png" />
</p>
</div>


<div class="figure">
<p><img src="img/redes-protocolos-2.png" alt="redes-protocolos-2.png" />
</p>
</div>
</div>

<div id="outline-container-unnumbered-28" class="outline-3">
<h3 id="unnumbered-28">Qué tiene un paquete TCP/IP?</h3>
<div class="outline-text-3" id="text-unnumbered-28">
<pre class="example">
+------------------------+--------------------------+
| MAC origen fe:ca:fe:ca | MAC destino  ca:fe:ca:fe |
+------------------------+--------------------------+
| IP origen 192.168.1.22 | IP destino  96.8.118.129 |
+---------------------------------------------------+
| Puerto origen    45678 | Puerto destino: 80       |
+------------------------+--------------------------+
| Nro Secuencia    12345 | Nro ACK                  |
+---+---+---+---+---+----+--------------------------+
| U | A | P | R | S | F | GET / HTTP/1.0            |
| R | C | S | S | Y | I |                           |
| G | K | H | T | N | N |                           |
+---+---+---+---+---+---+---------------------------+
</pre>
</div>
</div>

<div id="outline-container-unnumbered-29" class="outline-3">
<h3 id="unnumbered-29">Ethernet header</h3>
<div class="outline-text-3" id="text-unnumbered-29">
<pre class="example">
|                   |1                  |2                  |3  |
|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Hardware type         |          Protocol type        |
+---------------+---------------+-------------------------------+
|Hw address len.|Pr address len.|             Opcode            |
+---------------+---------------+-------------------------------+
|               Source hardware address                         |
+---------------------------------------------------------------+
|               Source protocol address                         |
+---------------------------------------------------------------+
|               Destination hardware address                    |
+---------------------------------------------------------------+
|               Destination protocol address                    |
+---------------------------------------------------------------+
|                            Data                               |
+---------------------------------------------------------------+
</pre>
</div>
</div>
</div>

<div id="outline-container-unnumbered-30" class="outline-2">
<h2 id="unnumbered-30">IP header</h2>
<div class="outline-text-2" id="text-unnumbered-30">
<pre class="example">
|                   |1                  |2                  |3  |
|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  | Diff.Services |     Total length              |
+-------+-------+---------------+-----+-------------------------+
|        Identification         |Flags|         Fragment offset |
+---------------+---------------+-----+-------------------------+
|    TTL        | Protocol      | Header checksum               |
+---------------+---------------+-------------------------------+
|                       Source IP address                       |
+---------------------------------------------------------------+
|                  Destination IP address                       |
+---------------------------------------------------------------+
|                     Options and padding                       |
+---------------------------------------------------------------+
</pre>
</div>
</div>

<div id="outline-container-unnumbered-31" class="outline-2">
<h2 id="unnumbered-31">UPD header</h2>
<div class="outline-text-2" id="text-unnumbered-31">
<pre class="example">
|                   |1                  |2                  |3  |
|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |        Destination Port       |
+-------------------------------+-------------------------------+
|          Length               |        Checksum               |
+-------------------------------+-------------------------------+
|                           Data                                |
+---------------------------------------------------------------+
</pre>
</div>
</div>

<div id="outline-container-unnumbered-32" class="outline-2">
<h2 id="unnumbered-32">TCP header</h2>
<div class="outline-text-2" id="text-unnumbered-32">
<pre class="example">
|                   |1                  |2                  |3  |
|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|2|3|4|5|6|7|8|9|0|1|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Source Port          |        Destination Port       |
+-------------------------------+-------------------------------+
|                        Sequence Number                        |
+-------------------------------+-------------------------------+
|                     Acknowledgment Number                     |
+-------+-----+-----+-+-+-+-+-+-+-------------------------------+
|dOffset|rsrvd| ECN |U|A|P|R|S|F|        Window                 |
|       |     |     |R|C|S|S|Y|I|                               |
|       |     |     |G|K|H|T|N|N|                               |
+-------+-----+-----+-+-+-+-+-+-+-------------------------------+
| Checksum                      | Urgent Pointer                |
+-------------------------------+-------------------------------+
|                      Options and padding                      |
+---------------------------------------------------------------+
|                           Data                                |
+---------------------------------------------------------------+
</pre>
</div>
</div>

<div id="outline-container-unnumbered-33" class="outline-2">
<h2 id="unnumbered-33">ChangeLog</h2>
<div class="outline-text-2" id="text-unnumbered-33">
<ul class="org-ul">
<li><span class="timestamp-wrapper"><span class="timestamp">[2013-06-05 mié] </span></span> simplifico y hago correcciones varias</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2013-04-09 mar] </span></span> corrijo gráficos ascii-art</li>
<li><span class="timestamp-wrapper"><span class="timestamp">[2013-04-04 jue] </span></span> primer borrador general</li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Osiris Alejandro Gómez (<a href="mailto:osiux@osiux.com">osiux@osiux.com</a>)</p>
<p class="date">Date: 2013-04-04</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.3beta)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
